<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Rxjs 操作符快速入门 | Lay</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="lay的博客">
    
    <link rel="preload" href="/blog/assets/css/0.styles.ca5e2506.css" as="style"><link rel="preload" href="/blog/assets/js/app.43ab55a0.js" as="script"><link rel="preload" href="/blog/assets/js/3.97d58727.js" as="script"><link rel="preload" href="/blog/assets/js/26.669fdc55.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.4efb53a8.js"><link rel="prefetch" href="/blog/assets/js/11.5d6fd622.js"><link rel="prefetch" href="/blog/assets/js/12.302e5d84.js"><link rel="prefetch" href="/blog/assets/js/13.84456cc2.js"><link rel="prefetch" href="/blog/assets/js/14.2b5fb73c.js"><link rel="prefetch" href="/blog/assets/js/15.57377f6d.js"><link rel="prefetch" href="/blog/assets/js/16.b4813ea3.js"><link rel="prefetch" href="/blog/assets/js/17.ec9ec8a5.js"><link rel="prefetch" href="/blog/assets/js/18.b1f34d25.js"><link rel="prefetch" href="/blog/assets/js/19.1ecc5374.js"><link rel="prefetch" href="/blog/assets/js/20.36c46317.js"><link rel="prefetch" href="/blog/assets/js/21.569dd724.js"><link rel="prefetch" href="/blog/assets/js/22.e6c70a3c.js"><link rel="prefetch" href="/blog/assets/js/23.228fdb21.js"><link rel="prefetch" href="/blog/assets/js/24.164ce356.js"><link rel="prefetch" href="/blog/assets/js/25.366cf1d4.js"><link rel="prefetch" href="/blog/assets/js/4.818c6fa1.js"><link rel="prefetch" href="/blog/assets/js/5.f5e1efcf.js"><link rel="prefetch" href="/blog/assets/js/6.e1fcd6ff.js"><link rel="prefetch" href="/blog/assets/js/7.b0aae4b9.js"><link rel="prefetch" href="/blog/assets/js/8.30c980de.js"><link rel="prefetch" href="/blog/assets/js/9.f11d5d94.js"><link rel="prefetch" href="/blog/assets/js/vendors~flowchart.4c11c543.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.ca5e2506.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">Lay</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/technology/Chrome/chrome-ext.html" class="nav-link">
  技术分享
</a></div><div class="nav-item"><a href="/blog/practice/Blog/vuepress.html" class="nav-link">
  实战分享
</a></div><div class="nav-item"><a href="/blog/notes/Typescript/TemplateLiteralTypes.html" class="nav-link">
  烂笔头
</a></div> <a href="https://github.com/lei4519/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/technology/Chrome/chrome-ext.html" class="nav-link">
  技术分享
</a></div><div class="nav-item"><a href="/blog/practice/Blog/vuepress.html" class="nav-link">
  实战分享
</a></div><div class="nav-item"><a href="/blog/notes/Typescript/TemplateLiteralTypes.html" class="nav-link">
  烂笔头
</a></div> <a href="https://github.com/lei4519/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Chrome</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Electron</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Git</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MiniProgram</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Web</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/technology/Web/regexp.html" class="sidebar-link">正则</a></li><li><a href="/blog/technology/Web/rxjs-operate.html" aria-current="page" class="active sidebar-link">Rxjs 操作符快速入门</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#阅读提醒" class="sidebar-link">阅读提醒</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#创建流操作符" class="sidebar-link">创建流操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#合并类操作符" class="sidebar-link">合并类操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#辅助类操作符" class="sidebar-link">辅助类操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#布尔类操作符" class="sidebar-link">布尔类操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#过滤类操作符" class="sidebar-link">过滤类操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#转化类操作符" class="sidebar-link">转化类操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#有损回压控制" class="sidebar-link">有损回压控制</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#无损回压控制" class="sidebar-link">无损回压控制</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#累计数据" class="sidebar-link">累计数据</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#错误处理" class="sidebar-link">错误处理</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#多播操作符" class="sidebar-link">多播操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#高阶合并类操作符" class="sidebar-link">高阶合并类操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#高阶切换类操作符" class="sidebar-link">高阶切换类操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#高阶map操作符" class="sidebar-link">高阶Map操作符</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#数据分组" class="sidebar-link">数据分组</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#结语" class="sidebar-link">结语</a></li><li class="sidebar-sub-header"><a href="/blog/technology/Web/rxjs-operate.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li><li><a href="/blog/technology/Web/lazy-img.html" class="sidebar-link">使用IntersectionObserver实现图片懒加载</a></li><li><a href="/blog/technology/Web/event-loop.html" class="sidebar-link">事件循环 - JS是怎么运行的？</a></li><li><a href="/blog/technology/Web/adaptive-fontsize.html" class="sidebar-link">pc端 rem布局 非chrome浏览器字号小于12px的解决方案</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rxjs-操作符快速入门"><a href="#rxjs-操作符快速入门" class="header-anchor">#</a> Rxjs 操作符快速入门</h1> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>好的程序员懂得如何从重复的工作中逃脱：</p> <div class="language- extra-class"><pre><code>- 操作DOM时，发现了Jquery。

- 操作JS时，发现了lodash。

- 操作事件时，发现了Rx。
</code></pre></div><p>Rxjs本身的 <a href="https://cn.rx.js.org/manual/overview.html" target="_blank" rel="noopener noreferrer">概念<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 并不复杂，简单点说就是对观察者模式的封装，观察者模式在前端领域大行其道，不管是使用框架还是原生JS，你一定都体验过。</p> <p>在我看来，Rxjs的强大和难点主要体现对其近120个操作符的灵活运用。</p> <p>可惜官网中对这些操作符的介绍晦涩难懂，这就导致了很多人明明理解Rxjs的概念，却苦于不懂的使用操作符而黯然离场。</p> <p>本文总结自《深入浅出Rxjs》一书，<strong>旨在于用最简洁、通俗易懂的方式来说明Rxjs常用操作符的作用。学习的同时，也可以做为平时快速查阅的索引列表</strong>。</p> <h2 id="阅读提醒"><a href="#阅读提醒" class="header-anchor">#</a> 阅读提醒</h2> <ul><li>流的概念</li></ul> <img src="https://cn.rx.js.org/manual/asset/marble-diagram-anatomy.svg"> <ul><li>订阅：调用 <code>subscribe</code></li> <li>吐出：调用 <code>next</code></li> <li>完成：调用 <code>complete</code></li></ul> <blockquote><p>需要注意流的完成和订阅时间，某些操作符必须等待流完成之后才会触发。</p> <p>其实根据操作符的功能我们也可以大致推断出结果：如果一个操作符需要拿到所有数据做操作、判断，那一定是需要等到流完成之后才能进行。</p></blockquote> <h2 id="创建流操作符"><a href="#创建流操作符" class="header-anchor">#</a> 创建流操作符</h2> <p>创建流操作符最为流的起点，不存在复杂难懂的地方，这里只做简单的归类，具体使用查阅官网即可，不再赘述。</p> <h3 id="同步流"><a href="#同步流" class="header-anchor">#</a> 同步流</h3> <ul><li>create：new Observable</li> <li>of</li> <li>range</li> <li>repeat</li> <li>empty</li> <li>never</li> <li>throw</li> <li>generate</li></ul> <h3 id="异步流"><a href="#异步流" class="header-anchor">#</a> 异步流</h3> <ul><li>interval/timer</li> <li>form：string/number/数组/类数组/promise/generator</li> <li>formPromise</li> <li>formEvent</li> <li>formEventPattern</li> <li>ajax</li> <li>repeatWhen</li> <li>defer：订阅时再创建</li></ul> <h2 id="合并类操作符"><a href="#合并类操作符" class="header-anchor">#</a> 合并类操作符</h2> <p>订阅多条流，将接收到的数据向下吐出。</p> <h3 id="concat"><a href="#concat" class="header-anchor">#</a> concat</h3> <p>首尾连接</p> <ul><li><p>依次订阅：前一个流完成，再订阅之后的流。</p></li> <li><p>当流全部完成时concat流结束。</p> <img src="https://cn.rx.js.org/img/concat.png" height="200"></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">concat</span><span class="token punctuation">(</span>source1$<span class="token punctuation">,</span> source2$<span class="token punctuation">)</span>
</code></pre></div><h3 id="merge"><a href="#merge" class="header-anchor">#</a> merge</h3> <p>先到先得</p> <ul><li><p>订阅所有流，任意流吐出数据后，merge流就会吐出数据。</p></li> <li><p>对异步数据才有意义。</p></li> <li><p>当流全部完成时merge流结束。</p> <img src="https://cn.rx.js.org/img/merge.png" height="200"></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">merge</span><span class="token punctuation">(</span>source1$<span class="token punctuation">,</span> source2$<span class="token punctuation">)</span>
</code></pre></div><h3 id="zip"><a href="#zip" class="header-anchor">#</a> zip</h3> <p>一对一合并（像拉链一样）</p> <ul><li>订阅所有流，等待所有的流都触发了<code>i</code>次，将第<code>i</code>次的数据合并成数组向下传递。</li> <li>其中一个流完成之后，等待另一个流的同等数量数据到来后完成zip流。</li> <li>当我们使用zip时，期望第一次接受到的数据是所有的流第一次发出的数据，第二次接受的是所有的流第二次发出的数据。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">zip</span><span class="token punctuation">(</span>source1$<span class="token punctuation">,</span> source2$<span class="token punctuation">)</span>
</code></pre></div><h3 id="combinelatest"><a href="#combinelatest" class="header-anchor">#</a> combineLatest</h3> <p>合并所有流的最后一个数据</p> <ul><li><p>订阅所有流，任意流触发时，获取其他所有流的最后值合并发出。</p></li> <li><p>因为要获取其他流的最后值，所以在刚开始时，必须等待所有流都吐出了值才能开始向下传递数据。</p></li> <li><p>所有的流都完成后，combineLatest流才会完成。</p> <img src="https://cn.rx.js.org/img/combineLatest.png" height="200"></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">combineLatest</span><span class="token punctuation">(</span>source1$<span class="token punctuation">,</span> source2$<span class="token punctuation">)</span>
</code></pre></div><h3 id="withlatestfrom"><a href="#withlatestfrom" class="header-anchor">#</a> withLatestFrom</h3> <p>合并所有流的最后一个数据，功能同combineLatest，区别在于：</p> <ul><li><p>combineLatest：当所有流准备完毕后（都有了最后值），任意流触发数据都会导致向下吐出数据。</p></li> <li><p>withLatestFrom：当所有流准备完毕后（都有了最后值），只有调用withLatestFrom的流吐出数据才会向下吐出数据，其他流触发时仅记录最后值。</p> <img src="https://cn.rx.js.org/img/withLatestFrom.png" height="200"></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    source1$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">withLatesFrom</span><span class="token punctuation">(</span>source2$<span class="token punctuation">,</span> source3$<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="race"><a href="#race" class="header-anchor">#</a> race</h3> <p>胜者通吃</p> <ul><li>订阅所有的流，当第一个流触发后，退订其他流。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">race</span><span class="token punctuation">(</span>source1$<span class="token punctuation">,</span> source2$<span class="token punctuation">)</span>
</code></pre></div><h3 id="startwith"><a href="#startwith" class="header-anchor">#</a> startWith</h3> <p>在流的前面填充数据</p> <img src="https://cn.rx.js.org/img/startWith.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>    source1$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">startWith</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="forkjoin"><a href="#forkjoin" class="header-anchor">#</a> forkJoin</h3> <p>合并所有流的最后一个数据</p> <ul><li>订阅所有流，等待所有流全部完成后，取出所有流的最后值向下发送。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>    <span class="token function">forkJoin</span><span class="token punctuation">(</span>source1$<span class="token punctuation">,</span> source2$<span class="token punctuation">)</span>
</code></pre></div><h2 id="辅助类操作符"><a href="#辅助类操作符" class="header-anchor">#</a> 辅助类操作符</h2> <h3 id="count"><a href="#count" class="header-anchor">#</a> count</h3> <p>当前流完成之后，统计流一共发出了多少个数据。</p> <img src="https://cn.rx.js.org/img/count.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mix-max"><a href="#mix-max" class="header-anchor">#</a> mix/max</h3> <p>当前流完成之后，计算 最小值/最大值。</p> <img src="https://cn.rx.js.org/img/max.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="reduce"><a href="#reduce" class="header-anchor">#</a> reduce</h3> <p>同数组用法，当前流完成之后，将接受的所有数据依次传入计算。</p> <img src="https://cn.rx.js.org/img/reduce.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="布尔类操作符"><a href="#布尔类操作符" class="header-anchor">#</a> 布尔类操作符</h2> <h3 id="every"><a href="#every" class="header-anchor">#</a> every</h3> <p>同数组，需要注意的是：如果条件都为true，也要等到流完成才会吐出结果。</p> <p>原因也很简单，如果流没有完成，那怎么保证后面的数据条件也为true呢。</p> <img src="https://cn.rx.js.org/img/every.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="find、findindex"><a href="#find、findindex" class="header-anchor">#</a> find、findIndex</h3> <p>同数组，注意点同every</p> <img src="https://cn.rx.js.org/img/find.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="isempty"><a href="#isempty" class="header-anchor">#</a> isEmpty</h3> <p>判断流是不是一个数据都没有吐出就完成了。</p> <img src="https://cn.rx.js.org/img/isEmpty.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="defaultifempty"><a href="#defaultifempty" class="header-anchor">#</a> defaultIfEmpty</h3> <p>如果流满足isEmpty，吐出默认值。</p> <img src="https://cn.rx.js.org/img/defaultIfEmpty.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">defaultIfEmpty</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="过滤类操作符"><a href="#过滤类操作符" class="header-anchor">#</a> 过滤类操作符</h2> <h3 id="filter"><a href="#filter" class="header-anchor">#</a> filter</h3> <p>同数组</p> <img src="https://cn.rx.js.org/img/filter.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="first"><a href="#first" class="header-anchor">#</a> first</h3> <p>取第一个满足条件的数据，如果不传入条件，就取第一个</p> <img src="https://cn.rx.js.org/img/first.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="last"><a href="#last" class="header-anchor">#</a> last</h3> <p>取第一个满足条件的数据，如果不传入条件，就取最后一个，流完成才会触发。</p> <img src="https://cn.rx.js.org/img/last.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">last</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="take"><a href="#take" class="header-anchor">#</a> take</h3> <p>拿够前 <code>N</code> 个就完成</p> <img src="https://cn.rx.js.org/img/take.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token constant">N</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="takelast"><a href="#takelast" class="header-anchor">#</a> takeLast</h3> <p>拿够后<code>N</code>个就结束，因为是后几个所以只有流完成了才会将数据一次发出。</p> <img src="https://cn.rx.js.org/img/takeLast.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeLast</span><span class="token punctuation">(</span><span class="token constant">N</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="takewhile"><a href="#takewhile" class="header-anchor">#</a> takeWhile</h3> <p>给我传判断函数，什么时候结束你来定</p> <img src="https://cn.rx.js.org/img/takeWhile.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeWhile</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="takeuntil"><a href="#takeuntil" class="header-anchor">#</a> takeUntil</h3> <p>给我一个流(A)，什么时候这个流(A)吐出数据了，我就完成</p> <img src="https://cn.rx.js.org/img/takeUntil.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">takeUntil</span><span class="token punctuation">(</span><span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="skip"><a href="#skip" class="header-anchor">#</a> skip</h3> <p>跳过前 <code>N</code> 个数据</p> <img src="https://cn.rx.js.org/img/skip.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token constant">N</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="skipwhile"><a href="#skipwhile" class="header-anchor">#</a> skipWhile</h3> <p>给我传函数，跳过前几个你来定</p> <img src="https://cn.rx.js.org/img/skipWhile.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">skipWhile</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="skipuntil"><a href="#skipuntil" class="header-anchor">#</a> skipUntil</h3> <p>给我一个流(A)，什么时候这个流(A)吐出数据了，我就不跳了</p> <img src="https://cn.rx.js.org/img/skipUntil.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">skipUntil</span><span class="token punctuation">(</span><span class="token function">timer</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="转化类操作符"><a href="#转化类操作符" class="header-anchor">#</a> 转化类操作符</h2> <h3 id="map"><a href="#map" class="header-anchor">#</a> map</h3> <ul><li>接受上游传入的值，返回一个其他的值给下游。（如果你还返回上游的值，那就没有任何意义了）</li></ul> <img src="https://cn.rx.js.org/img/map.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mapto"><a href="#mapto" class="header-anchor">#</a> mapTo</h3> <ul><li>将传入的值给下游。</li></ul> <img src="https://cn.rx.js.org/img/mapTo.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mapTo</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="pluck"><a href="#pluck" class="header-anchor">#</a> pluck</h3> <ul><li>提取上游吐出对象的某个key，传给下游。</li></ul> <img src="https://cn.rx.js.org/img/pluck.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">'v'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="有损回压控制"><a href="#有损回压控制" class="header-anchor">#</a> 有损回压控制</h2> <blockquote><p>对防抖、节流不了解的请自行查阅相关说明。</p></blockquote> <h3 id="throttle"><a href="#throttle" class="header-anchor">#</a> throttle</h3> <p>传入一个流(A)，对上游数据进行节流，直到流(A)吐出数据时结束节流向下传递数据，然后重复此过程</p> <img src="https://cn.rx.js.org/img/throttle.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">throttle</span><span class="token punctuation">(</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="throttletime"><a href="#throttletime" class="header-anchor">#</a> throttleTime</h3> <p>根据时间(ms)节流</p> <img src="https://cn.rx.js.org/img/throttleTime.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">throttleTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="debounce"><a href="#debounce" class="header-anchor">#</a> debounce</h3> <p>传入一个流(A)，对上游数据进行防抖，直到流(A)吐出数据时结束防抖向下传递数据，然后重复此过程</p> <img src="https://cn.rx.js.org/img/debounce.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">debounce</span><span class="token punctuation">(</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="debouncetime"><a href="#debouncetime" class="header-anchor">#</a> debounceTime</h3> <p>根据时间(ms)防抖</p> <img src="https://cn.rx.js.org/img/debounceTime.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">debounceTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="audit"><a href="#audit" class="header-anchor">#</a> audit</h3> <p>audit 同 throttle，区别在于：</p> <ul><li>throttle：将节流期间接受的第一个数据发出</li> <li>audit：将节流期间接受的最后一个数据发出</li></ul> <img src="https://cn.rx.js.org/img/audit.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">audit</span><span class="token punctuation">(</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="audittime"><a href="#audittime" class="header-anchor">#</a> auditTime</h3> <p>同上，不再赘述</p> <img src="https://cn.rx.js.org/img/auditTime.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">auditTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="sample"><a href="#sample" class="header-anchor">#</a> sample</h3> <ul><li><p>正常的流，上游触发，下游就会收到数据。</p></li> <li><p>使用了sample之后的流，会将上游发出的最新一个数据缓存，然后按照自己的节奏从缓存中取。</p></li> <li><p>换句话说，不管上游发出数据的速度是快是慢。sample都不管，他就按照自己的节奏从缓存中取数，如果缓存中有就向下游吐出。如果没有就不做动作。</p></li></ul> <p>传入一个流(A)，对上游数据吐出的最新数据进行缓存，直到流(A)吐出数据时从缓存中取出数据向下传递，然后重复此过程</p> <img src="https://cn.rx.js.org/img/sample.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sample</span><span class="token punctuation">(</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="sampletime"><a href="#sampletime" class="header-anchor">#</a> sampleTime</h3> <p>根据时间(ms)取数</p> <img src="https://cn.rx.js.org/img/sampleTime.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">sampleTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="distinct"><a href="#distinct" class="header-anchor">#</a> distinct</h3> <ul><li>distinct前缀表示去重操作</li></ul> <p>所有元素去重，返回当前流中从来没有出现过的数据。</p> <p>传入函数时，根据函数的返回值分配唯一key。</p> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
Observable<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token punctuation">{</span> age<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token string">'Foo'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> p<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="distinctuntilchanged"><a href="#distinctuntilchanged" class="header-anchor">#</a> distinctUntilChanged</h3> <p>相邻元素去重，只返回与上一个数据不同的数据。</p> <p>传入函数时，根据函数的返回值分配唯一key。</p> <img src="https://cn.rx.js.org/img/distinctUntilChanged.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">distinctUntilChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="distinctuntilkeychanged"><a href="#distinctuntilkeychanged" class="header-anchor">#</a> distinctUntilKeyChanged</h3> <ul><li>distinctUntilChanged的简化版，帮你实现了取对象key的逻辑。</li></ul> <img src="https://cn.rx.js.org/img/distinctUntilKeyChanged.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">distinctUntilKeyChanged</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="ignoreelements"><a href="#ignoreelements" class="header-anchor">#</a> ignoreElements</h3> <p>忽略上游的所有数据，当上游完成时，ignoreElements也会完成。（我不关心你做了什么，只要告诉我完没完成就行）</p> <img src="https://cn.rx.js.org/img/ignoreElements.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">ignoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="elementat"><a href="#elementat" class="header-anchor">#</a> elementAt</h3> <p>只获取上游数据发出的第N个数据。</p> <p>第二个参数相当于默认值：当上游没发出第N个数据就结束时，发出这个参数给下游。</p> <img src="https://cn.rx.js.org/img/elementAt.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">elementAt</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="single"><a href="#single" class="header-anchor">#</a> single</h3> <ul><li>检查上游的所有数据，如果满足条件的数据只有一个，就向下发送这个数据。否则向下传递异常。</li></ul> <img src="https://cn.rx.js.org/img/single.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">single</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="无损回压控制"><a href="#无损回压控制" class="header-anchor">#</a> 无损回压控制</h2> <ul><li>buffer前缀：将值缓存到数组中，吐出给下游。</li> <li>window前缀：将值缓存到一个流中，吐出给下游。</li></ul> <h3 id="buffertime、windowtime"><a href="#buffertime、windowtime" class="header-anchor">#</a> bufferTime、windowTime</h3> <p>缓存上游吐出的数据，到指定时间后吐出，然后重复。</p> <img src="https://cn.rx.js.org/img/bufferTime.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">bufferTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="buffercount、windowcount"><a href="#buffercount、windowcount" class="header-anchor">#</a> bufferCount、windowCount</h3> <p>缓存上游吐出的数据，到指定个数后吐出，然后重复。</p> <p>第二个参数用来控制每隔几个数据开启一次缓存区，不传时可能更符合我们的认知。</p> <img src="https://cn.rx.js.org/img/bufferCount.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">bufferCount</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="bufferwhen、windowwhen"><a href="#bufferwhen、windowwhen" class="header-anchor">#</a> bufferWhen、windowWhen</h3> <p>传入一个返回流(A)的工厂函数</p> <p>流程如下：</p> <ol><li>触发订阅时，调用工厂函数拿到流(A)，开始缓存</li> <li>等待流(A)发出数据时，将缓存的值向下吐出</li> <li>重新调用工厂函数，拿到一个新的流(A)，开启缓存，循环往复。</li></ol> <img src="https://cn.rx.js.org/img/bufferWhen.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function-variable function">randomSeconds</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">timer</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10000</span> <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">)</span>
source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">bufferWhen</span><span class="token punctuation">(</span>randomSeconds<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="buffertoggle、windowtoggle"><a href="#buffertoggle、windowtoggle" class="header-anchor">#</a> bufferToggle、windowToggle</h3> <p>第一个参数为开启缓存流(O)，第二个参数为返回关闭缓存流(C)的工厂函数</p> <p>流程如下：</p> <ol><li>当开启流(O)吐出数据时，调用工厂函数获取关闭流(C)，开始缓存</li> <li>等待关闭流(C)吐出数据后，将缓存的值向下吐出</li> <li>等待开启流(O)吐出数据，然后重复步骤1</li></ol> <img src="https://cn.rx.js.org/img/bufferToggle.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">bufferToggle</span><span class="token punctuation">(</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> randomSeconds<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="buffer、window"><a href="#buffer、window" class="header-anchor">#</a> buffer、window</h3> <p>传入一个关闭流(C)，区别与bufferWhen：传入的是流，而不是返回流的工厂函数。</p> <p>触发订阅时，开始缓存，当关闭流(C)吐出数据时，将缓存的值向下传递并重新开始缓存。</p> <img src="https://cn.rx.js.org/img/buffer.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="累计数据"><a href="#累计数据" class="header-anchor">#</a> 累计数据</h2> <h3 id="scan"><a href="#scan" class="header-anchor">#</a> scan</h3> <p>scan和reduce的区别在于：</p> <ul><li>reduce：只有当流完成后才会触发</li> <li>scan：每一次流接受到数据后都会触发</li></ul> <p>区别于其他流，scan拥有了保存、记忆状态的能力。</p> <img src="https://cn.rx.js.org/img/scan.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">scan</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mergescan"><a href="#mergescan" class="header-anchor">#</a> mergeScan</h3> <p>同scan，但是返回的不是数据而是一个流。</p> <ul><li>当上游吐出数据时，调用规约函数得到并订阅流(A)，将流(A)返回的数据向下游传递，并缓存流(A)返回的最后一个数据。当上游再次吐出数据时，将缓存的最后一个数据传给规约函数，循环往复。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mergeScan</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="错误处理"><a href="#错误处理" class="header-anchor">#</a> 错误处理</h2> <h3 id="catch"><a href="#catch" class="header-anchor">#</a> catch</h3> <p>捕获错误</p> <img src="https://cn.rx.js.org/img/catch.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token keyword">of</span><span class="token punctuation">(</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token string">'II'</span><span class="token punctuation">,</span> <span class="token string">'III'</span><span class="token punctuation">,</span> <span class="token string">'IV'</span><span class="token punctuation">,</span> <span class="token string">'V'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="retry"><a href="#retry" class="header-anchor">#</a> retry</h3> <p>传入数字 <code>N</code>，遇到错误时，重新订阅上游，重试 <code>N</code> 次结束。</p> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">retry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="retrywhen"><a href="#retrywhen" class="header-anchor">#</a> retryWhen</h3> <p>传入流(A)，遇到错误时，订阅流(A)，流(A)每吐出一次数据，就重试一次。流完成，retrywfhen也完成。</p> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">retryWhen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="finally"><a href="#finally" class="header-anchor">#</a> finally</h3> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="多播操作符"><a href="#多播操作符" class="header-anchor">#</a> 多播操作符</h2> <h3 id="multicast"><a href="#multicast" class="header-anchor">#</a> multicast</h3> <p>接收返回<code>Subject</code>的工厂函数，返回一个<code>hot observable</code>（HO）</p> <p>当链接开始时，订阅上游获取数据，调用工厂函数拿到<code>Subject</code>，上游吐出的数据通过<code>Subject</code>进行多播。</p> <ul><li>返回的HO拥有<code>connect</code>、<code>refCount</code>方法。</li> <li>调用<code>connect</code>才会真正开始订阅顶流并发出数据。</li> <li>调用<code>refCount</code>则会根据<code>subscribe</code>数量自动进行<code>connect</code>和<code>unsubscribe</code>操作。</li> <li>多播操作符的老大，较为底层的设计，日常使用不多。</li> <li>后面的多播操作符都是基于此操作符实现。</li></ul> <img src="https://cn.rx.js.org/img/multicast.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">multicast</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="publish"><a href="#publish" class="header-anchor">#</a> publish</h3> <ul><li>封装了multicast操作符需要传入Subject工厂函数的操作，其他保持一致。</li></ul> <img src="https://cn.rx.js.org/img/publish.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="share"><a href="#share" class="header-anchor">#</a> share</h3> <p>基于publish的封装，返回调用refCount后的结果（看代码）</p> <img src="https://cn.rx.js.org/img/share.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">share</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 等同于</span>
source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">refCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="publishlast"><a href="#publishlast" class="header-anchor">#</a> publishLast</h3> <p>当上游完成后，多播上游的最后一个数据并完成当前流。</p> <img src="https://cn.rx.js.org/img/publishLast.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">publishLast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="publishreplay"><a href="#publishreplay" class="header-anchor">#</a> publishReplay</h3> <p>传入缓存数量 <code>N</code> ，缓存上游最新的 <code>N</code> 个数据，当有新的订阅时，将缓存吐出。</p> <ul><li>上游只会被订阅一次。</li></ul> <img src="https://cn.rx.js.org/img/publishReplay.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">publishReplay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="publishbehavior"><a href="#publishbehavior" class="header-anchor">#</a> publishBehavior</h3> <p>缓存上游吐出的最新数据，当有新的订阅时，将最新值吐出。如果被订阅时上游从未吐出过数据，就吐出传入的默认值。</p> <img src="https://cn.rx.js.org/img/publishBehavior.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">publishBehavior</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="高阶合并类操作符"><a href="#高阶合并类操作符" class="header-anchor">#</a> 高阶合并类操作符</h2> <ul><li><strong>高阶</strong>操作符不是高级操作符</li> <li>当一个流吐出的不是数据，而是一个流时，这就是一个高阶流，就像如果一个函数的返回值还是一个函数的话，我们就称之为高阶函数</li> <li>高阶操作符就是操作高阶流的操作符</li></ul> <p>如下代码示例，顶层的流吐出的并不是普通的数据，而是两个会产生数据的流，那么此时下游在接受时，就需要对上游吐出的流进行订阅获取数据，如下：</p> <div class="language- extra-class"><pre class="language-text"><code>of(of(1, 2, 3), of(4, 5, 6))
	.subscribe(
		ob =&gt; ob.subscribe((num) =&gt; {
			console.log(num)
		})
	)
</code></pre></div><p>上面的代码只是简单的将数据从流中取出，如果我想对吐出的流运用前面讲的操作符应该怎么办？</p> <div class="language- extra-class"><pre class="language-text"><code>cache = []
of(of(1, 2, 3), of(4, 5, 6))
	.subscribe({
		next: ob =&gt; cache.push(ob),
		complete: {
			concat(...cache).subscribe(console.log)
			zip(...cache).subscribe(console.log)
		}
	})
</code></pre></div><p>先不管上述实现是否合理，我们已经可以对上游吐出的流运用操作符了，但是这样实现未免也太过麻烦，所以Rxjs为我们封装了相关的操作符来帮我们实现上述的功能。</p> <p>总结一下：<strong>高阶操作符操作的是流，普通操作符操作的是数据。</strong></p> <h3 id="concatall"><a href="#concatall" class="header-anchor">#</a> concatAll</h3> <p>对应concat，缓存高阶流吐出的每一个流，依次订阅，当所有流全部完成，concatAll随之完成。</p> <img src="https://cn.rx.js.org/img/concatAll.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">concatAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="mergeall"><a href="#mergeall" class="header-anchor">#</a> mergeAll</h3> <p>对应merge，订阅高阶流吐出的每一个流，任意流吐出数据，mergeAll随之吐出数据。</p> <img src="https://cn.rx.js.org/img/mergeAll.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">mergeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="zipall"><a href="#zipall" class="header-anchor">#</a> zipAll</h3> <p>对应zip，订阅高阶流吐出的每一个流，合并这些流吐出的相同索引的数据向下传递。</p> <img src="https://cn.rx.js.org/img/zipAll.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">zipAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="combineall"><a href="#combineall" class="header-anchor">#</a> combineAll</h3> <p>对应combineLatest，订阅高阶流吐出的每一个流，合并所有流的最后值向下传递。</p> <img src="https://cn.rx.js.org/img/combineAll.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">combineAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="高阶切换类操作符"><a href="#高阶切换类操作符" class="header-anchor">#</a> 高阶切换类操作符</h2> <h3 id="switch"><a href="#switch" class="header-anchor">#</a> switch</h3> <p>切换流 - 喜新厌旧</p> <p>高阶流每吐出一个流时，就会退订上一个吐出的流，订阅最新吐出的流。</p> <img src="https://cn.rx.js.org/img/switch.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token keyword">switch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="exhaust"><a href="#exhaust" class="header-anchor">#</a> exhaust</h3> <p>切换流 - 长相厮守</p> <p>当高阶流吐出一个流时，订阅它。在这个流没有完成之前，忽略这期间高阶流吐出的所有的流。当这个流完成之后，等待订阅高阶流吐出的下一个流订阅，重复。</p> <img src="https://cn.rx.js.org/img/exhaust.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">exhaust</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="高阶map操作符"><a href="#高阶map操作符" class="header-anchor">#</a> 高阶Map操作符</h2> <p>看完例子，即知定义。</p> <h3 id="例子"><a href="#例子" class="header-anchor">#</a> 例子</h3> <p>实现如下功能：</p> <ul><li><code>mousedown</code>事件触发后，监听<code>mousemove</code>事件</li></ul> <h4 id="普通实现"><a href="#普通实现" class="header-anchor">#</a> 普通实现</h4> <div class="language-js extra-class"><pre class="language-js"><code>mousedown$ <span class="token operator">=</span> <span class="token function">formEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">'mousedown'</span><span class="token punctuation">)</span>
mousemove$ <span class="token operator">=</span> <span class="token function">formEvent</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> <span class="token string">'mousemove'</span><span class="token punctuation">)</span>

mousedown$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
	<span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mousemove$<span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token function">mergeAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><ol><li>当<code>mousedown</code>事件触发后，使用<code>map</code>操作符，将向下吐出的数据转换成<code>mousemove</code>事件流。</li> <li>由于返回的是流而非数据，所以需要使用<code>mergeAll</code>操作符帮我们将流中的数据展开。</li> <li>这样我们最终接受到的就是<code>mousemove</code>的<code>event</code>事件对象了。</li></ol> <p>注：由于只有一个事件流，所以使用上面介绍的任意高阶合并操作符都是一样的效果。</p> <h4 id="高阶map实现"><a href="#高阶map实现" class="header-anchor">#</a> 高阶Map实现</h4> <div class="language-js extra-class"><pre class="language-js"><code>mousedown$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
  <span class="token function">mergeMap</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> mousemove$<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>不难看出，所谓高阶map，就是</p> <div class="language- extra-class"><pre class="language-text"><code>concatMap 	= map + concatAll
mergeMap 		= map + mergeAll
switchMap 	= map + switch
exhaustMap 	= map + exhaust
concatMapTo = mapTo + concatAll
mergeMapTo 	= mapTo + mergeAll
switchMapTo = mapTo + switch
</code></pre></div><h3 id="expand"><a href="#expand" class="header-anchor">#</a> expand</h3> <p>类似于<code>mergeMap</code>，但是，所有传递给下游的数据，同时也会传递给自己，所以expand是一个递归操作符。</p> <img src="https://cn.rx.js.org/img/expand.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">expand</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token operator">=&gt;</span> x <span class="token operator">===</span> <span class="token number">8</span> <span class="token operator">?</span> <span class="token constant">EMPTY</span> <span class="token operator">:</span> x <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="数据分组"><a href="#数据分组" class="header-anchor">#</a> 数据分组</h2> <h3 id="groupby"><a href="#groupby" class="header-anchor">#</a> groupBy</h3> <p>输出流，将上游传递进来的数据，根据key值分类，为每一个分类创建一个流传递给下游。</p> <p>key值由第一个函数参数来控制。</p> <img src="https://cn.rx.js.org/img/groupBy.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token parameter">i</span> <span class="token operator">=&gt;</span> i <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="partition"><a href="#partition" class="header-anchor">#</a> partition</h3> <p>groupBy的简化版，传入判断条件，满足条件的放入第一个流中，不满足的放入第二个流中。</p> <p>简单说：</p> <ul><li>groupBy根据key的分类，可能会向下传递N条流。</li> <li>partition只会向下传递两条流：满足条件的和不满足条件的。</li></ul> <img src="https://cn.rx.js.org/img/partition.png" height="200"> <div class="language-js extra-class"><pre class="language-js"><code>source$<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">partition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="结语"><a href="#结语" class="header-anchor">#</a> 结语</h2> <p>以上就是本文的全部内容了，希望你看了会有收获。</p> <p>如果有不理解的部分，可以在评论区提出，大家一起成长进步。</p> <p>祝大家早日拿下Rxjs这块难啃的骨头。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://cn.rx.js.org/manual/overview.html" target="_blank" rel="noopener noreferrer">官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>《深入浅出Rxjs》</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/lei4519/blog/edit/master/src/technology/Web/rxjs-operate.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">19 天前</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/technology/Web/regexp.html" class="prev">
        正则
      </a></span> <span class="next"><a href="/blog/technology/Web/lazy-img.html">
        使用IntersectionObserver实现图片懒加载
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/blog/assets/js/app.43ab55a0.js" defer></script><script src="/blog/assets/js/3.97d58727.js" defer></script><script src="/blog/assets/js/26.669fdc55.js" defer></script>
  </body>
</html>
